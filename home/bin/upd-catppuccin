#! /bin/sh -u

say() {     echo "[1m$@[0m"   ; }
ok()  {     echo "[1;32m$@[0m"; }
ko()  { >&2 echo "[1;31m$@[0m"; }

install() {
    say Update $1...
    case $1 in
        fcitx5)
            mkdir -p "$XDG_DATA_HOME/fcitx5/themes"
            cp -r src/catppuccin-latte-yellow "$XDG_DATA_HOME/fcitx5/themes/default"
            cp -r src/catppuccin-mocha-yellow "$XDG_DATA_HOME/fcitx5/themes/default-dark"
            ;;
        *) echo huh; exit 1 ;;
    esac
    ok Updated $1
}

mkdir -p "$XDG_DATA_HOME/$(basename $0)" && cd "$XDG_DATA_HOME/$(basename $0)"
for repo in https://github.com/catppuccin/fcitx5
do (
    set -e
    readonly dir=$(basename $repo .git)
    if [ ! -d $dir ]; then
        say Clone $dir...
        git clone --depth 1 $repo
        cd $dir && install $dir
    else
        say Update $dir...
        cd $dir
        if [ $(git fetch && git rev-list --count ..@{u}) -gt 0 ]; then
            git merge @{u} --ff-only
            install $dir
        else
            say Already up to date.
        fi
    fi
)
[ $? -eq 0 ] || ko Failed to process $repo
done
