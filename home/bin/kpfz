#! /bin/sh

pass=$(fuzzel --dmenu --password --lines=0)                                                             || exit 0
item=$(echo "$pass" | keepassxc-cli ls   "$XDG_DATA_HOME/main.kdbx" | ifne fuzzel --dmenu --only-match) || exit 0
attr=$(echo "$pass" | keepassxc-cli show "$XDG_DATA_HOME/main.kdbx" "$item"                             \
    | sed -n '/^Password:/{p;b};H;${g;s/\n//p}' `# [p]rint Password; [H]old the rest until $`           \
    | ifne fuzzel --dmenu --nth-delimiter=: --accept-nth=1 --only-match)                                || exit 0
echo "$pass"        | keepassxc-cli clip "$XDG_DATA_HOME/main.kdbx" "$item" --attribute="$attr"
